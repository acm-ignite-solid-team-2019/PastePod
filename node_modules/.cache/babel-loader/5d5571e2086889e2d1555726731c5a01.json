{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/home/evan/Documents/Solid/solid-app/solid-ignite/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/home/evan/Documents/Solid/solid-app/solid-ignite/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _classCallCheck = require(\"/home/evan/Documents/Solid/solid-app/solid-ignite/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/home/evan/Documents/Solid/solid-app/solid-ignite/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _possibleConstructorReturn = require(\"/home/evan/Documents/Solid/solid-app/solid-ignite/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/possibleConstructorReturn\");\n\nvar _getPrototypeOf = require(\"/home/evan/Documents/Solid/solid-app/solid-ignite/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/getPrototypeOf\");\n\nvar _inherits = require(\"/home/evan/Documents/Solid/solid-app/solid-ignite/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar PagedAsyncRdfIterator_1 = require(\"./PagedAsyncRdfIterator\");\n/**\n * A PagedAsyncRdfIterator that pages based on a set of mediators.\n *\n * It expects the first page to be already processed partially.\n * Based on the data stream of the first page, and a promise to the metadata of the first page,\n * it will emit data elements from this page and all following pages using the 'next' metadata link.\n *\n * `mediatorRdfDereference` is used to dereference the 'next' link to a quad stream.\n * `mediatorMetadata` is used to split this quad stream into a data and metadata stream.\n * `mediatorMetadataExtract` is used to collect the metadata object from this metadata stream,\n * possibly containing another 'next' link.\n */\n\n\nvar MediatedPagedAsyncRdfIterator =\n/*#__PURE__*/\nfunction (_PagedAsyncRdfIterato) {\n  _inherits(MediatedPagedAsyncRdfIterator, _PagedAsyncRdfIterato);\n\n  function MediatedPagedAsyncRdfIterator(firstPageUrl, firstPageData, firstPageMetadata, mediatorRdfDereference, mediatorMetadata, mediatorMetadataExtract, context) {\n    var _this;\n\n    _classCallCheck(this, MediatedPagedAsyncRdfIterator);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(MediatedPagedAsyncRdfIterator).call(this, firstPageUrl, {\n      autoStart: false\n    }));\n    _this.firstPageData = firstPageData;\n    _this.firstPageMetadata = firstPageMetadata;\n    _this.mediatorRdfDereference = mediatorRdfDereference;\n    _this.mediatorMetadata = mediatorMetadata;\n    _this.mediatorMetadataExtract = mediatorMetadataExtract;\n    _this.context = context;\n    return _this;\n  }\n\n  _createClass(MediatedPagedAsyncRdfIterator, [{\n    key: \"getIterator\",\n    value: function () {\n      var _getIterator = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(url, page, onNextPage) {\n        var _this2 = this;\n\n        var pageData, next, pageQuads, pageMetaSplit;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (page) {\n                  _context.next = 14;\n                  break;\n                }\n\n                pageData = this.firstPageData;\n                _context.prev = 2;\n                _context.next = 5;\n                return this.firstPageMetadata();\n\n              case 5:\n                next = _context.sent.next;\n                _context.next = 11;\n                break;\n\n              case 8:\n                _context.prev = 8;\n                _context.t0 = _context[\"catch\"](2);\n                this.emit('error', _context.t0);\n\n              case 11:\n                onNextPage(next);\n                _context.next = 22;\n                break;\n\n              case 14:\n                _context.next = 16;\n                return this.mediatorRdfDereference.mediate({\n                  context: this.context,\n                  url: url\n                });\n\n              case 16:\n                pageQuads = _context.sent;\n                _context.next = 19;\n                return this.mediatorMetadata.mediate({\n                  context: this.context,\n                  pageUrl: pageQuads.pageUrl,\n                  quads: pageQuads.quads,\n                  triples: pageQuads.triples\n                });\n\n              case 19:\n                pageMetaSplit = _context.sent;\n                pageData = pageMetaSplit.data; // Don't await, we want to process metadata in the background.\n\n                this.mediatorMetadataExtract.mediate({\n                  context: this.context,\n                  pageUrl: pageQuads.pageUrl,\n                  metadata: pageMetaSplit.metadata\n                }).then(function (result) {\n                  return onNextPage(result.metadata.next);\n                }).catch(function (e) {\n                  return _this2.emit('error', e);\n                });\n\n              case 22:\n                return _context.abrupt(\"return\", pageData);\n\n              case 23:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[2, 8]]);\n      }));\n\n      function getIterator(_x, _x2, _x3) {\n        return _getIterator.apply(this, arguments);\n      }\n\n      return getIterator;\n    }()\n  }]);\n\n  return MediatedPagedAsyncRdfIterator;\n}(PagedAsyncRdfIterator_1.PagedAsyncRdfIterator);\n\nexports.MediatedPagedAsyncRdfIterator = MediatedPagedAsyncRdfIterator;","map":null,"metadata":{},"sourceType":"script"}